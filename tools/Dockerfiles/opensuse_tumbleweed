FROM opensuse/tumbleweed

# Install generic dependencies to build jss
RUN true \
        && zypper refresh \
        && zypper update -y \
        && zypper install -y \
                          gcc make rpm-build cmake \
                          ws-jaxme java-11-openjdk mozilla-nss-tools \
                          apache-commons-codec apache-commons-lang gcc-c++ \
                          java-11-openjdk-devel javapackages-tools slf4j mozilla-nss \
                          zlib-devel mozilla-nss-devel mozilla-nspr-devel perl \
                          zip unzip junit4 \
        && mkdir -p /home/sandbox \
        && zypper clean --all \
        && rm -rf /usr/share/doc /usr/share/doc-base \
                  /usr/share/man /usr/share/locale /usr/share/zoneinfo \
        && true

# Link in the current version of jss from the git repository
WORKDIR /home/sandbox
COPY . /home/sandbox/jss

# Perform the actual build
WORKDIR /home/sandbox/jss
CMD true \
        && export JAVA_HOME=/usr/lib64/jvm/java-11-openjdk-11 \
        && rm -rf build \
        && mkdir build \
        && cd build \
        && cmake .. \
        && make all test \
        && true
